<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Page</title>


</head>
<body>

<div class="alert-box">
    <p class="alert"></p>
</div>

<div class="form">
    <h1 class="heading">auth</h1>
    <input type="email" placeholder="email" autocomplete="off" class="email" required>
    <input type="password" placeholder="password" autocomplete="off" class="password" required>
    <button class="submit-btn">log in</button>
    <a href="/register" class="link">don't have an account? Register one</a>
</div>

<script>

    const form = [...document.querySelector('.form').children];

    form.forEach((item, i) => {
        setTimeout(() => {
            item.style.opacity = 1;
        }, i*100);
    })

    window.onload = () => {
        if(sessionStorage.name){
            location.href = '/';
        }
    }

    const email = document.querySelector('.email');
    const password = document.querySelector('.password');
    const submitBtn = document.querySelector('.submit-btn');


    submitBtn.addEventListener('click', () => {
        console.log("send")
        fetch('/login', {
            method: 'post',
            headers: new Headers({'Content-Type': 'application/json'}),
            body: JSON.stringify({
                email: email.value,
                password: password.value
            })
        })
            .then(res => {
                if (res.status === 200) {
                    // Redirect the user to the home page
                    window.location.href = '/';
                } else {
                    // Display an error message
                    return res.json();
                }
            })
            .then(data => {
                if (data) {
                    validateData(data);
                }
            })
    })

    const validateData = (data) => {
        if(!data.name){
            alertBox(data);
        } else{
            sessionStorage.name = data.name;
            sessionStorage.email = data.email;
            location.href = '/';
        }
    }

    const alertBox = (data) => {
        const alertContainer = document.querySelector('.alert-box');
        const alertMsg = document.querySelector('.alert');
        alertMsg.innerHTML = data;

        alertContainer.style.opacity = `100%`;
        setTimeout(() => {
            alertContainer.style.opacity = null;
        }, 3000);
    }
</script>

</body>
</html>