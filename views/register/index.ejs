<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register Page</title>

    <!---<link rel="stylesheet" href="css/form.css"-->

</head>
<body>

<div class="alert-box">
    <p class="alert"></p>
</div>

<div class="form">
    <h1 class="heading">Register</h1>
    <input type="text" placeholder="name" autocomplete="off" class="name" required>
    <input type="email" placeholder="email" autocomplete="off" class="email" required>
    <input type="id" placeholder="id" autocomplete="off" class="id" required>
    <input type="tel" placeholder="phone number" autocomplete="off" class="phone" required>
    <input type="date" placeholder="birth date" autocomplete="off" class="date" required>
    <div class="admin-toggle">
        <input type="checkbox" id="admin-checkbox">
        <label for="admin-checkbox">Admin</label>
    </div>
    <input type="password" placeholder="password" autocomplete="off" class="password" required>
    <button class="submit-btn">register</button>
    <a href="/login" class="link">already have an account ? log in here</a>
</div>

<script>
    // form loading animation

    const form = [...document.querySelector('.form').children];

    form.forEach((item, i) => {
        setTimeout(() => {
            item.style.opacity = 1;
        }, i*100);
    })

    window.onload = () => {
        if(sessionStorage.name){
            location.href = '/';
        }
    }

    // form validation

    const name = document.querySelector('.name');
    const email = document.querySelector('.email');
    const password = document.querySelector('.password');
    const id = document.querySelector('.id');
    const date = document.querySelector('.date');
    const phone = document.querySelector('.phone');
    const admin = document.getElementById("admin-checkbox");
    const submitBtn = document.querySelector('.submit-btn');


        submitBtn.addEventListener('click', () => {
            console.log("date: " + date.value)
            fetch('/register', {
                method: 'post',
                headers: new Headers({'Content-Type': 'application/json'}),
                body: JSON.stringify({
                    name: name.value,
                    email: email.value,
                    id: id.value,
                    date: date.value,
                    phone: phone.value,
                    admin: admin.value,
                    password: password.value
                })
            })
                .then(res => res.json())
                .then(data => {
                    validateData(data);
                })
        })


    const validateData = (data) => {
        if(!data.name){
            alertBox(data);
        } else{
            sessionStorage.name = data.name;
            sessionStorage.email = data.email;
            location.href = '/';
        }
    }

    const alertBox = (data) => {
        const alertContainer = document.querySelector('.alert-box');
        const alertMsg = document.querySelector('.alert');
        alertMsg.innerHTML = data;

        alertContainer.style.opacity = `100%`;
        setTimeout(() => {
            alertContainer.style.opacity = null;
        }, 3000);
    }
</script>

</body>
</html>